# 批量获取音标脚本

## 功能说明

这个脚本用于批量从 Wiktionary 获取所有德语单词的 IPA 音标，并将音标数据保存到 `public/words.json` 中。

## 使用方法

### 1. 首次使用需要安装依赖

```bash
npm install
# 或
pnpm install
```

这会自动安装 `jsdom` 等必要的依赖。

### 2. 运行脚本

```bash
npm run fetch-phonetics
```

或者

```bash
node scripts/fetchPhonetics.js
```

## 工作原理

1. 读取 `public/words.json` 文件
2. 对于每个没有音标的单词：
   - 清理单词（去掉冠词、复数标记等）
   - 调用 Wiktionary API 获取 HTML 页面
   - 提取 `<span class="ipa">` 标签中的音标
   - 确保音标格式为 `/xxx/`
   - 更新到 word 对象的 `phonetic` 字段
3. 每处理 10 个单词自动保存一次（防止中断丢失数据）
4. 处理完成后显示统计信息

## 特性

- ✅ **断点续传**：已有音标的单词会自动跳过
- ✅ **自动保存**：每 10 个单词保存一次进度
- ✅ **速率限制**：默认每个请求间隔 200ms，避免 API 限流
- ✅ **详细日志**：实时显示处理进度和结果
- ✅ **错误处理**：单个单词失败不影响整体进度

## 输出示例

```
🚀 开始批量获取音标...

📚 共 2060 个单词

[1/2060] 🔍 获取: Deutschland
[1/2060] ✅ 成功: Deutschland -> /ˈdɔʏtʃlant/

[2/2060] 🔍 获取: Österreich
[2/2060] ✅ 成功: Österreich -> /ˈøːstɐʁaɪ̯ç/

...

💾 已保存进度 (10/2060)

...

==================================================
✨ 批量获取完成！
✅ 成功: 1850
⏭️  跳过: 0
⚠️  失败: 210
📊 总计: 2060
==================================================
```

## 注意事项

1. **网络连接**：需要能访问 `de.wiktionary.org`
2. **执行时间**：2000+ 个单词大约需要 10-15 分钟
3. **中断恢复**：如果脚本中断，再次运行会从未完成的单词继续
4. **失败单词**：部分单词可能在 Wiktionary 上没有音标数据

## 修改参数

可以在脚本中修改以下参数：

```javascript
const DELAY_MS = 200; // API 调用间隔（毫秒）
```

如果遇到 API 限流，可以增加这个值。

## 数据格式

更新后的 `words.json` 格式：

```json
[
  {
    "word": "das Haus, -̈er",
    "zh_cn": "房子",
    "phonetic": "/haʊ̯s/"
  }
]
```

